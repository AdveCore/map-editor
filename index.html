<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tibia Map Editor</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Top Toolbar -->
        <div id="toolbar">
            <div class="toolbar-group">
                <span class="toolbar-label">Warstwa:</span>
                <button id="btn-ground" class="layer-btn active" data-layer="ground">üå± Ground</button>
                <button id="btn-decoration" class="layer-btn" data-layer="decoration">üå≥ Decoration</button>
                <button id="btn-both" class="layer-btn" data-layer="both">üëÅÔ∏è Wszystko</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button id="btn-undo" class="tool-btn">&#x21b6; Cofnij</button>
                <button id="btn-eraser" class="tool-btn">&#x1f9f9; Gumka</button>
                <button id="btn-export" class="tool-btn">&#x1f5be; Eksportuj</button>
                <button id="btn-save-map" class="tool-btn">&#x1f4be; Zapisz mapƒô</button>
                <button id="btn-load-map" class="tool-btn">&#x1f4c2; Wczytaj mapƒô</button>
                <button id="btn-favorites" class="tool-btn">&#x2b50; Ulubione</button>
                <button id="btn-cave" class="tool-btn">&#x1f5d1; Jaskinia</button>
                <button id="btn-grid" class="tool-btn active">&#x229e; Siatka</button>
                <button id="btn-reset-zoom" class="tool-btn">&#x1f50d; Reset zoom</button>
                <button id="btn-last-tile" class="tool-btn">&#x1f449; Ostatni kafelek</button>
                <button id="btn-fill" class="tool-btn">&#x1f7ea; Wype≈Çnij</button>
                <button id="btn-pick" class="tool-btn">&#x1f50d; Pipeta</button>
                <button id="btn-clear-selection" class="tool-btn">&#x274c; Wyczy≈õƒá</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group">
                <button id="btn-cave" class="tool-btn cave-btn">&#x26cf; Generate Cave</button>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-group export-group">
                <input type="text" id="map-name" placeholder="Nazwa lokacji np. jaskinia_smoka">
                <button id="btn-export" class="tool-btn export-btn">&#x1f4be; Eksportuj JSON</button>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Phaser Canvas -->
            <div id="game-container"></div>

            <!-- Right Panel - Tileset Palette -->
            <div id="right-panel">
                <h3>&#x1f3a8; Tileset Library</h3>
                <div class="library-controls">
                    <button id="btn-manage-library" class="tool-btn">&#x1f5da; ZarzƒÖdzaj bibliotekƒÖ</button>
                    <button id="btn-manage-uploads" class="tool-btn">&#x1f527; ZarzƒÖdzaj uploadami</button>
                    <button id="btn-export-library" class="tool-btn">&#x1f517; Eksportuj bibliotekƒô</button>
                    <button id="btn-import-library" class="tool-btn">&#x1f515; Importuj bibliotekƒô</button>
                    <button id="btn-cloud-config" class="tool-btn">&#x2699; Konfiguracja chmury</button>
                </div>
                <div class="upload-section">
                    <label for="tileset-upload" class="upload-label">&#x1f4c2; Wgraj Tileset (.png / .jpg)</label>
                    <input type="file" id="tileset-upload" accept=".png,.jpg,.jpeg">
                    <button id="btn-upload-to-library" class="tool-btn" style="margin-top: 8px;">üì§ Wgraj do biblioteki</button>
                </div>
                <div id="tileset-list"></div>
                <div id="palette-container">
                    <canvas id="palette-canvas"></canvas>
                    <div id="palette-controls">
                        <button class="palette-zoom-btn" id="palette-zoom-in">+</button>
                        <span id="palette-zoom-level">100%</span>
                        <button class="palette-zoom-btn" id="palette-zoom-out">-</button>
                        <button class="palette-zoom-btn" id="palette-zoom-reset">‚ü≤</button>
                    </div>
                </div>
                <div id="brush-info">
                    <span>&#x1f58c; P&#x119;dzel: <strong id="brush-label">Brak</strong></span>
                    <span id="tileset-info"></span>
                </div>
            </div>

            <!-- Library Management Modal -->
            <div id="library-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>&#x1f5da; ZarzƒÖdzanie BibliotekƒÖ Tileset√≥w</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="library-stats">
                            <span>Zapisane tilesety: <strong id="library-count">0</strong></span>
                            <button id="btn-clear-library" class="tool-btn danger">&#x1f5d1; Wyczy≈õƒá bibliotekƒô</button>
                        </div>
                        <div id="library-list"></div>
                    </div>
                </div>
            </div>

            <!-- Upload Tileset Modal -->
            <div id="upload-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>&#x1f4c2; Wgraj Tileset do Biblioteki</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="upload-form">
                            <div class="disclaimer">
                                <h4>‚öñÔ∏è Wa≈ºne - Prawne warunki</h4>
                                <p>WgrywajƒÖc tileset o≈õwiadczasz ≈ºe:</p>
                                <ul>
                                    <li>Masz pe≈Çne prawa do udostƒôpnienia tego pliku</li>
                                    <li>Tileset jest licencjonowany jako darmowy do u≈ºytku komercyjnego i niekomercyjnego</li>
                                    <li>Nie narusza praw autorskich ≈ºadnej trzeciej strony</li>
                                    <li>Przyjmujesz pe≈ÇnƒÖ odpowiedzialno≈õƒá za wgrany content</li>
                                </ul>
                                <p><strong>Nielegalne tre≈õci zostanƒÖ usuniƒôte, a konto zablokowane.</strong></p>
                            </div>
                            <div class="form-group">
                                <label for="upload-file">Plik tilesetu:</label>
                                <input type="file" id="upload-file" accept=".png,.jpg,.jpeg" required>
                            </div>
                            <div class="form-group">
                                <label for="upload-name">Nazwa:</label>
                                <input type="text" id="upload-name" placeholder="np. Forest Tiles" required>
                            </div>
                            <div class="form-group">
                                <label for="upload-description">Opis:</label>
                                <textarea id="upload-description" placeholder="Opis tilesetu..." rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="upload-license">Licencja:</label>
                                <select id="upload-license" required>
                                    <option value="CC0">CC0 - Public Domain (Free for all)</option>
                                    <option value="CC-BY">CC-BY - Attribution</option>
                                    <option value="CC-BY-SA">CC-BY-SA - ShareAlike</option>
                                    <option value="MIT">MIT License</option>
                                    <option value="Free">Free for commercial & non-commercial</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="upload-tags">Tagi (przecinkami):</label>
                                <input type="text" id="upload-tags" placeholder="np. forest, nature, trees">
                            </div>
                            <div class="form-group">
                                <label for="github-token">GitHub Token (dla uploadu):</label>
                                <input type="password" id="github-token" placeholder="ghp_...">
                                <small>Token z GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens</small>
                            </div>
                            <div class="form-actions">
                                <button id="btn-cancel-upload" class="tool-btn">Anuluj</button>
                                <button id="btn-confirm-upload" class="tool-btn">üì§ Wgraj tileset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cloud Save/Load Modal -->
        <div id="cloud-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>&#x2601; ZarzƒÖdzanie Mapami w Chmurze</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="cloud-tabs">
                        <button id="cloud-save-tab" class="tab-btn active">Zapisz mapƒô</button>
                        <button id="cloud-load-tab" class="tab-btn">Wczytaj mapƒô</button>
                    </div>
                    
                    <!-- Save Tab -->
                    <div id="cloud-save-panel" class="tab-panel active">
                        <div class="form-group">
                            <label for="cloud-map-name">Nazwa mapy:</label>
                            <input type="text" id="cloud-map-name" placeholder="np. My Adventure Map" required>
                        </div>
                        <div class="form-group">
                            <label for="cloud-map-desc">Opis:</label>
                            <textarea id="cloud-map-desc" placeholder="Opis mapy..." rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button id="btn-confirm-cloud-save" class="tool-btn">&#x2601; Zapisz w chmurze</button>
                        </div>
                    </div>
                    
                    <!-- Load Tab -->
                    <div id="cloud-load-panel" class="tab-panel">
                        <div class="cloud-maps-list" id="cloud-maps-list">
                            <p class="loading-message">≈Åadowanie map...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Management Modal -->
        <div id="upload-management-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>&#x1f527; ZarzƒÖdzanie Uploadami</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="admin-section">
                        <h3>&#x1f511; U≈ºytkownicy z uprawnieniami</h3>
                        <div class="user-list" id="approved-users">
                            <!-- Lista zatwierdzonych u≈ºytkownik√≥w -->
                        </div>
                        <div class="add-user-section">
                            <input type="text" id="new-username" placeholder="GitHub username">
                            <button id="btn-add-user" class="tool-btn">‚ûï Dodaj u≈ºytkownika</button>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h3>&#x23f3; OczekujƒÖce uploady</h3>
                        <div class="pending-uploads" id="pending-uploads">
                            <p class="loading-message">Brak oczekujƒÖcych upload√≥w</p>
                        </div>
                    </div>
                    
                    <div class="admin-section">
                        <h3>&#x1f5d1; Zg≈Çoszone tre≈õci</h3>
                        <div class="reported-content" id="reported-content">
                            <p class="loading-message">Brak zg≈Çoszonych tre≈õci</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map Management Modal -->
        <div id="map-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>&#x1f4c2; ZarzƒÖdzanie Mapami</h2>
                    <div class="user-info">
                        <span>&#x1f464; <span id="current-user-name">User1234</span></span>
                        <button id="btn-change-name" class="tool-btn small">Zmie≈Ñ</button>
                    </div>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="map-tabs">
                        <button id="map-save-tab" class="tab-btn active">Zapisz mapƒô</button>
                        <button id="map-load-tab" class="tab-btn">Wczytaj mapƒô</button>
                        <button id="map-favorites-tab" class="tab-btn">‚≠ê Ulubione</button>
                    </div>
                    
                    <!-- Save Tab -->
                    <div id="map-save-panel" class="tab-panel active">
                        <div class="form-group">
                            <label for="local-map-name">Nazwa mapy:</label>
                            <input type="text" id="local-map-name" placeholder="np. My Castle" required>
                        </div>
                        <div class="form-group">
                            <label for="map-category">Kategoria:</label>
                            <select id="map-category">
                                <option value="castle">üè∞ Zamek</option>
                                <option value="city">üèôÔ∏è Miasto</option>
                                <option value="forest">üå≤ Las</option>
                                <option value="cave">‚õ∞Ô∏è Jaskinia</option>
                                <option value="dungeon">üóùÔ∏è Loch</option>
                                <option value="village">üèòÔ∏è Wioska</option>
                                <option value="mountain">üèîÔ∏è G√≥ry</option>
                                <option value="beach">üèÑ Pla≈ºa</option>
                                <option value="other">üìÑ Inne</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button id="btn-confirm-save-map" class="tool-btn">&#x1f4be; Zapisz mapƒô</button>
                        </div>
                    </div>
                    
                    <!-- Load Tab -->
                    <div id="map-load-panel" class="tab-panel">
                        <div class="category-filter">
                            <label>Filtruj kategoriƒô:</label>
                            <select id="category-filter">
                                <option value="all">Wszystkie</option>
                                <option value="castle">üè∞ Zamek</option>
                                <option value="city">üèôÔ∏è Miasto</option>
                                <option value="forest">üå≤ Las</option>
                                <option value="cave">‚õ∞Ô∏è Jaskinia</option>
                                <option value="dungeon">üóùÔ∏è Loch</option>
                                <option value="village">üèòÔ∏è Wioska</option>
                                <option value="mountain">üèîÔ∏è G√≥ry</option>
                                <option value="beach">üèÑ Pla≈ºa</option>
                                <option value="other">üìÑ Inne</option>
                            </select>
                        </div>
                        <div class="local-maps-list" id="local-maps-list">
                            <p class="loading-message">Brak zapisanych map</p>
                        </div>
                    </div>
                    
                    <!-- Favorites Tab -->
                    <div id="map-favorites-panel" class="tab-panel">
                        <div class="favorites-list" id="favorites-list">
                            <p class="loading-message">Brak ulubionych map</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="login-modal" class="modal" style="display: block;">
            <div class="modal-content" style="max-width: 400px;">
                <div class="modal-header">
                    <h2>üîê Logowanie</h2>
                </div>
                <div class="modal-body">
                    <div class="login-tabs">
                        <button id="login-tab" class="tab-btn active">Zaloguj siƒô</button>
                        <button id="register-tab" class="tab-btn">Zarejestruj</button>
                    </div>
                    
                    <!-- Login Panel -->
                    <div id="login-panel" class="tab-panel active">
                        <div class="form-group">
                            <label for="login-username">Login:</label>
                            <input type="text" id="login-username" placeholder="Tw√≥j login" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Has≈Ço:</label>
                            <input type="password" id="login-password" placeholder="Twoje has≈Ço" required>
                        </div>
                        <div class="form-actions">
                            <button id="btn-login" class="tool-btn">üîì Zaloguj siƒô</button>
                        </div>
                    </div>
                    
                    <!-- Register Panel -->
                    <div id="register-panel" class="tab-panel">
                        <div class="form-group">
                            <label for="register-username">Login:</label>
                            <input type="text" id="register-username" placeholder="Wybierz login" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password">Has≈Ço:</label>
                            <input type="password" id="register-password" placeholder="Min. 6 znak√≥w" required>
                        </div>
                        <div class="form-group">
                            <label for="register-password-confirm">Powt√≥rz has≈Ço:</label>
                            <input type="password" id="register-password-confirm" placeholder="Powt√≥rz has≈Ço" required>
                        </div>
                        <div class="form-actions">
                            <button id="btn-register" class="tool-btn">‚úÖ Zarejestruj siƒô</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <span id="cursor-pos">X: 0  Y: 0</span>
            <span id="zoom-level">Zoom: 100%</span>
            <span id="layer-indicator">Warstwa: Ground</span>
            <span class="status-hint">PPM / &#x15a;PM: Przesuwanie &nbsp;|&nbsp; Scroll: Zoom &nbsp;|&nbsp; LPM: Rysuj &nbsp;|&nbsp; LPM+Drag na palecie: Zaznacz &nbsp;|&nbsp; Ctrl+LPM: Multi-select &nbsp;|&nbsp; Shift+LPM / &#x15a;PM na palecie: Przesu≈Ñ</span>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="game.js"></script>
</body>
</html>
